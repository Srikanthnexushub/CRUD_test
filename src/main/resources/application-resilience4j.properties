# ============================================================================
# Resilience4j Circuit Breaker Configuration
# ============================================================================

# Circuit Breaker for Database Operations
resilience4j.circuitbreaker.instances.database.register-health-indicator=true
resilience4j.circuitbreaker.instances.database.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.database.sliding-window-size=10
resilience4j.circuitbreaker.instances.database.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.database.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.database.slow-call-rate-threshold=80
resilience4j.circuitbreaker.instances.database.slow-call-duration-threshold=3s
resilience4j.circuitbreaker.instances.database.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.database.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.database.automatic-transition-from-open-to-half-open-enabled=true

# Circuit Breaker for External API Calls
resilience4j.circuitbreaker.instances.external-api.register-health-indicator=true
resilience4j.circuitbreaker.instances.external-api.sliding-window-type=TIME_BASED
resilience4j.circuitbreaker.instances.external-api.sliding-window-size=60
resilience4j.circuitbreaker.instances.external-api.minimum-number-of-calls=3
resilience4j.circuitbreaker.instances.external-api.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.external-api.slow-call-rate-threshold=70
resilience4j.circuitbreaker.instances.external-api.slow-call-duration-threshold=5s
resilience4j.circuitbreaker.instances.external-api.wait-duration-in-open-state=60s
resilience4j.circuitbreaker.instances.external-api.permitted-number-of-calls-in-half-open-state=2

# Circuit Breaker for Email Service
resilience4j.circuitbreaker.instances.email.register-health-indicator=true
resilience4j.circuitbreaker.instances.email.sliding-window-size=10
resilience4j.circuitbreaker.instances.email.failure-rate-threshold=40
resilience4j.circuitbreaker.instances.email.wait-duration-in-open-state=120s

# ============================================================================
# Retry Configuration
# ============================================================================

# Retry for Database Operations
resilience4j.retry.instances.database.max-attempts=3
resilience4j.retry.instances.database.wait-duration=500ms
resilience4j.retry.instances.database.enable-exponential-backoff=true
resilience4j.retry.instances.database.exponential-backoff-multiplier=2
resilience4j.retry.instances.database.retry-exceptions=java.sql.SQLException,org.springframework.dao.DataAccessException

# Retry for External API
resilience4j.retry.instances.external-api.max-attempts=3
resilience4j.retry.instances.external-api.wait-duration=1s
resilience4j.retry.instances.external-api.enable-exponential-backoff=true
resilience4j.retry.instances.external-api.exponential-backoff-multiplier=2

# ============================================================================
# Bulkhead Configuration (Thread Pool Isolation)
# ============================================================================

# Bulkhead for Database Operations
resilience4j.bulkhead.instances.database.max-concurrent-calls=20
resilience4j.bulkhead.instances.database.max-wait-duration=100ms

# Bulkhead for External API
resilience4j.bulkhead.instances.external-api.max-concurrent-calls=10
resilience4j.bulkhead.instances.external-api.max-wait-duration=500ms

# Thread Pool Bulkhead
resilience4j.thread-pool-bulkhead.instances.database.max-thread-pool-size=10
resilience4j.thread-pool-bulkhead.instances.database.core-thread-pool-size=5
resilience4j.thread-pool-bulkhead.instances.database.queue-capacity=100

# ============================================================================
# Rate Limiter Configuration (Additional to Bucket4j)
# ============================================================================

# Rate Limiter for External API Calls
resilience4j.ratelimiter.instances.external-api.limit-for-period=10
resilience4j.ratelimiter.instances.external-api.limit-refresh-period=1s
resilience4j.ratelimiter.instances.external-api.timeout-duration=0s

# ============================================================================
# Time Limiter Configuration
# ============================================================================

# Time Limiter for External API
resilience4j.timelimiter.instances.external-api.timeout-duration=5s
resilience4j.timelimiter.instances.external-api.cancel-running-future=true
