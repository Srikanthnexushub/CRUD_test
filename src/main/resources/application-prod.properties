# ============================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ============================================================================
# This profile is for PRODUCTION DEPLOYMENT
#
# CRITICAL: All sensitive values MUST be provided via environment variables
#
# To activate: java -jar app.jar --spring.profiles.active=prod
#           or set SPRING_PROFILES_ACTIVE=prod
#
# REQUIRED ENVIRONMENT VARIABLES:
#   - JWT_SECRET (minimum 256 bits)
#   - DB_URL, DB_USERNAME, DB_PASSWORD
#   - ADMIN_PASSWORD (strong password)
#   - SMTP_USERNAME, SMTP_PASSWORD
#   - REDIS_PASSWORD (if Redis requires auth)
# ============================================================================

# Server Configuration
server.port=${SERVER_PORT:8080}

# Database Configuration (Production uses managed PostgreSQL with strict validation)
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# Flyway (Enabled in production for controlled migrations)
spring.flyway.enabled=true
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false

# Logging (Production level - minimal but informative)
logging.level.root=WARN
logging.level.org.example=INFO
logging.level.org.springframework=WARN
logging.level.org.hibernate.SQL=ERROR

# Logging to files (Production logs)
logging.file.name=/var/log/crud-test/application.log
logging.file.max-size=50MB
logging.file.max-history=30
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{correlationId}] %logger{36} - %msg%n

# Database Connection Pool (Production sized)
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# JWT Configuration (MUST use environment variables)
jwt.secret=${JWT_SECRET}
jwt.expiration=3600000
jwt.refresh-expiration=604800000

# Admin User (Password MUST be provided via environment)
app.admin.username=${ADMIN_USERNAME:admin}
app.admin.password=${ADMIN_PASSWORD}
app.admin.email=${ADMIN_EMAIL}

# Email Configuration (Production SMTP)
spring.mail.host=${SMTP_HOST}
spring.mail.port=${SMTP_PORT:587}
spring.mail.username=${SMTP_USERNAME}
spring.mail.password=${SMTP_PASSWORD}
app.mail.enabled=true

# Redis (Production configuration with auth)
spring.cache.type=redis
spring.data.redis.host=${REDIS_HOST}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD}
spring.data.redis.ssl.enabled=${REDIS_SSL_ENABLED:true}

# Actuator (Limited exposure, authenticated access only)
management.endpoint.health.show-details=when-authorized
management.endpoints.web.exposure.include=health,info,metrics,prometheus

# Swagger UI (Disabled in production for security)
springdoc.swagger-ui.enabled=false
springdoc.api-docs.enabled=${API_DOCS_ENABLED:false}

# Error Stack Traces (Never expose in production)
server.error.include-stacktrace=never
server.error.include-exception=false

# Security (Strict production settings)
app.security.account-lock.max-failed-attempts=5
app.security.account-lock.lockout-duration-minutes=30
app.security.password.expiration-days=90
app.security.password.history-count=5

# Rate Limiting (Enabled and strict in production)
app.rate-limit.enabled=true
app.rate-limit.general.capacity=100
app.rate-limit.general.refill-tokens=100
app.rate-limit.general.refill-duration-seconds=60
app.rate-limit.auth.capacity=5
app.rate-limit.auth.refill-tokens=5
app.rate-limit.auth.refill-duration-seconds=60

# Feature Flags (All enabled in production)
app.features.mfa-enabled=true
app.features.audit-logging-enabled=true
app.features.threat-intelligence-enabled=true
app.features.email-notifications-enabled=true

# CORS (Strict - only allow specific production domains)
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS}

# Banner (Off in production)
spring.main.banner-mode=off

# Security Headers
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict

# Production Optimizations
spring.jpa.properties.hibernate.jdbc.batch_size=30
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.query.in_clause_parameter_padding=true
spring.jpa.properties.hibernate.query.plan_cache_max_size=2048
spring.jpa.properties.hibernate.query.plan_parameter_metadata_max_size=128

# Connection Pool Leak Detection (Production monitoring)
spring.datasource.hikari.leak-detection-threshold=60000

# Resilience (Production circuit breaker settings)
resilience4j.circuitbreaker.instances.emailService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.emailService.wait-duration-in-open-state=60000
resilience4j.circuitbreaker.instances.emailService.sliding-window-size=10

# Spring Boot Admin (Optional)
spring.boot.admin.client.enabled=${SPRING_BOOT_ADMIN_ENABLED:false}
spring.boot.admin.client.url=${SPRING_BOOT_ADMIN_URL:}

# Metrics Tags
management.metrics.tags.environment=production
management.metrics.tags.region=${DEPLOYMENT_REGION:us-east-1}
