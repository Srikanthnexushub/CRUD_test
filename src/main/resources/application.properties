# ============================================================================
# CRUD Test Application - Base Configuration
# Enterprise-Grade Configuration Management
# ============================================================================
#
# This is the base configuration file. Environment-specific settings are in:
# - application-dev.properties (development)
# - application-test.properties (testing)
# - application-prod.properties (production)
#
# To run with a specific profile:
#   mvn spring-boot:run -Dspring-boot.run.profiles=dev
#   java -jar app.jar --spring.profiles.active=prod
#
# SECURITY: All sensitive values MUST be provided via environment variables
# ============================================================================

# Application Info
spring.application.name=CRUD Test Application
app.version=2.0.0

# Active Profile (override via environment variable or command line)
spring.profiles.active=${SPRING_PROFILES_ACTIVE:dev}

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
server.port=${SERVER_PORT:8080}
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain
server.http2.enabled=true

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/crud_test_db}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pool (HikariCP) - Optimized for Production
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:20}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=${DB_CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${DB_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${DB_MAX_LIFETIME:1800000}
spring.datasource.hikari.keepalive-time=${DB_KEEPALIVE_TIME:300000}
spring.datasource.hikari.leak-detection-threshold=${DB_LEAK_DETECTION:60000}
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.pool-name=CRUDAppHikariPool
spring.datasource.hikari.auto-commit=true
spring.datasource.hikari.register-mbeans=true

# JPA/Hibernate Configuration - Optimized for Performance
spring.jpa.hibernate.ddl-auto=${DB_DDL_AUTO:validate}
spring.jpa.show-sql=${DB_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=${DB_FORMAT_SQL:false}
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.jdbc.fetch_size=50
spring.jpa.properties.hibernate.default_batch_fetch_size=16
spring.jpa.properties.hibernate.generate_statistics=${HIBERNATE_STATS:false}
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.use_query_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
spring.jpa.properties.hibernate.javax.cache.provider=org.ehcache.jsr107.EhcacheCachingProvider
spring.jpa.open-in-view=false

# ============================================================================
# FLYWAY DATABASE MIGRATION
# ============================================================================
spring.flyway.enabled=${FLYWAY_ENABLED:true}
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=true

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# JWT Configuration
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:3600000}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}

# Admin User Configuration (Initial Setup Only)
app.admin.username=${ADMIN_USERNAME:admin}
app.admin.password=${ADMIN_PASSWORD}
app.admin.email=${ADMIN_EMAIL:admin@example.com}

# Password Policy
app.security.password.min-length=8
app.security.password.require-uppercase=true
app.security.password.require-lowercase=true
app.security.password.require-digit=true
app.security.password.require-special=false
app.security.password.expiration-days=90
app.security.password.history-count=5

# Account Locking Policy
app.security.account-lock.max-failed-attempts=${MAX_FAILED_ATTEMPTS:5}
app.security.account-lock.lockout-duration-minutes=${LOCKOUT_DURATION_MINUTES:30}
app.security.account-lock.reset-time-minutes=${RESET_TIME_MINUTES:15}

# IP Blocking Policy
app.security.ip-block.max-failed-attempts=${IP_MAX_FAILED_ATTEMPTS:10}

# Login Attempts Retention
app.security.login-attempts.retention-days=${LOGIN_ATTEMPTS_RETENTION_DAYS:90}

# Session Configuration
app.security.session.max-concurrent-sessions=3
app.security.session.timeout-minutes=60

# Refresh Token Configuration
app.security.refresh-token.max-active-tokens=${REFRESH_TOKEN_MAX_ACTIVE:5}

# ============================================================================
# RATE LIMITING CONFIGURATION
# ============================================================================
app.rate-limit.enabled=${RATE_LIMIT_ENABLED:true}

# General API Rate Limiting (100 requests per minute per IP)
app.rate-limit.general.capacity=${RATE_LIMIT_GENERAL_CAPACITY:100}
app.rate-limit.general.refill-tokens=${RATE_LIMIT_GENERAL_REFILL:100}
app.rate-limit.general.refill-duration-seconds=${RATE_LIMIT_GENERAL_DURATION:60}

# Authentication Rate Limiting (5 attempts per minute per IP)
app.rate-limit.auth.capacity=${RATE_LIMIT_AUTH_CAPACITY:5}
app.rate-limit.auth.refill-tokens=${RATE_LIMIT_AUTH_REFILL:5}
app.rate-limit.auth.refill-duration-seconds=${RATE_LIMIT_AUTH_DURATION:60}

# API Rate Limiting by User (1000 requests per minute)
app.rate-limit.api.capacity=${RATE_LIMIT_API_CAPACITY:1000}
app.rate-limit.api.refill-tokens=${RATE_LIMIT_API_REFILL:1000}
app.rate-limit.api.refill-duration-seconds=${RATE_LIMIT_API_DURATION:60}

# MFA Rate Limiting (5 attempts per 5 minutes)
app.rate-limit.mfa.capacity=${RATE_LIMIT_MFA_CAPACITY:5}
app.rate-limit.mfa.refill-tokens=${RATE_LIMIT_MFA_REFILL:5}
app.rate-limit.mfa.refill-duration-seconds=${RATE_LIMIT_MFA_DURATION:300}

# ============================================================================
# EMAIL CONFIGURATION
# ============================================================================
spring.mail.host=${SMTP_HOST:smtp.gmail.com}
spring.mail.port=${SMTP_PORT:587}
spring.mail.username=${SMTP_USERNAME}
spring.mail.password=${SMTP_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# Application Email Settings
app.mail.from=${MAIL_FROM_ADDRESS:noreply@crudtest.com}
app.mail.from-name=${MAIL_FROM_NAME:CRUD Test Application}
app.mail.enabled=${MAIL_ENABLED:true}
app.mail.retry-attempts=3
app.mail.retry-delay-ms=5000

# ============================================================================
# MFA (MULTI-FACTOR AUTHENTICATION) CONFIGURATION
# ============================================================================
app.name=${APP_NAME:CRUDTest}
mfa.backup-codes.count=${MFA_BACKUP_CODES_COUNT:10}
mfa.trusted-device.duration-days=${MFA_TRUSTED_DEVICE_DURATION_DAYS:30}

# ============================================================================
# PASSWORD RESET CONFIGURATION
# ============================================================================
app.security.password-reset.token-expiration-minutes=${PASSWORD_RESET_TOKEN_EXPIRATION:30}
app.security.password-reset.max-requests-per-hour=${PASSWORD_RESET_MAX_REQUESTS:3}

# ============================================================================
# SCHEDULED TASKS CONFIGURATION
# ============================================================================
app.scheduled.cleanup-login-attempts=${SCHEDULED_CLEANUP_LOGIN_ATTEMPTS:0 0 2 * * *}
app.scheduled.cleanup-trusted-devices=${SCHEDULED_CLEANUP_TRUSTED_DEVICES:0 30 2 * * *}
app.scheduled.cleanup-password-reset-tokens=${SCHEDULED_CLEANUP_PASSWORD_RESET:0 0 3 * * *}
app.scheduled.health-check=${SCHEDULED_HEALTH_CHECK:0 0 * * * *}

# ============================================================================
# ACTUATOR & MONITORING CONFIGURATION
# ============================================================================
management.endpoints.web.exposure.include=${ACTUATOR_ENDPOINTS:health,info,metrics,prometheus,env,loggers,threaddump,heapdump}
management.endpoint.health.show-details=${HEALTH_SHOW_DETAILS:when-authorized}
management.endpoint.health.show-components=${HEALTH_SHOW_COMPONENTS:when-authorized}
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true
management.metrics.enable.http=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.info.env.enabled=true
management.info.java.enabled=true
management.info.os.enabled=true

# Application Information
info.app.name=${spring.application.name}
info.app.version=@project.version@
info.app.description=@project.description@
info.app.java.version=@java.version@

# ============================================================================
# REDIS CACHE CONFIGURATION
# ============================================================================
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=2

# Cache Configuration
spring.cache.type=redis
spring.cache.redis.time-to-live=3600000
spring.cache.redis.cache-null-values=false

# ============================================================================
# ACTUATOR & MONITORING
# ============================================================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=${ACTUATOR_SHOW_DETAILS:when-authorized}
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.tags.application=${spring.application.name}
management.metrics.tags.environment=${spring.profiles.active}

# Info Endpoint
info.app.name=${spring.application.name}
info.app.version=${app.version}
info.app.description=Enterprise-Grade CRUD Application with JWT Authentication
info.app.java.version=${java.version}

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
logging.level.root=${LOG_LEVEL_ROOT:INFO}
logging.level.org.example=${LOG_LEVEL_APP:INFO}
logging.level.org.springframework=${LOG_LEVEL_SPRING:WARN}
logging.level.org.hibernate.SQL=${LOG_LEVEL_SQL:WARN}
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=${LOG_LEVEL_SQL_BIND:WARN}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# ============================================================================
# JACKSON JSON CONFIGURATION
# ============================================================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
spring.jackson.default-property-inclusion=non_null
spring.jackson.serialization.fail-on-empty-beans=false

# ============================================================================
# SPRING BOOT ADMIN (Optional)
# ============================================================================
spring.boot.admin.client.url=${SPRING_BOOT_ADMIN_URL:}
spring.boot.admin.client.instance.management-url=${management.endpoints.web.base-path:}
spring.boot.admin.client.enabled=${SPRING_BOOT_ADMIN_ENABLED:false}

# ============================================================================
# RESILIENCE4J CIRCUIT BREAKER
# ============================================================================
resilience4j.circuitbreaker.instances.emailService.register-health-indicator=true
resilience4j.circuitbreaker.instances.emailService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.emailService.wait-duration-in-open-state=60000
resilience4j.circuitbreaker.instances.emailService.sliding-window-size=10

# ============================================================================
# ASYNC CONFIGURATION
# ============================================================================
spring.task.execution.pool.core-size=5
spring.task.execution.pool.max-size=10
spring.task.execution.pool.queue-capacity=25
spring.task.execution.thread-name-prefix=async-

# ============================================================================
# MULTIPART FILE UPLOAD
# ============================================================================
spring.servlet.multipart.max-file-size=${MAX_FILE_SIZE:10MB}
spring.servlet.multipart.max-request-size=${MAX_REQUEST_SIZE:10MB}
spring.servlet.multipart.enabled=true

# ============================================================================
# API DOCUMENTATION (SpringDoc OpenAPI)
# ============================================================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=${SWAGGER_ENABLED:true}
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha
springdoc.show-actuator=false

# ============================================================================
# APPLICATION FEATURE FLAGS
# ============================================================================
app.features.mfa-enabled=${FEATURE_MFA_ENABLED:true}
app.features.audit-logging-enabled=${FEATURE_AUDIT_ENABLED:true}
app.features.threat-intelligence-enabled=${FEATURE_THREAT_INTEL_ENABLED:true}
app.features.email-notifications-enabled=${FEATURE_EMAIL_NOTIFICATIONS:true}

# ============================================================================
# BANNER
# ============================================================================
spring.main.banner-mode=${BANNER_MODE:console}

# ============================================================================
# ERROR HANDLING
# ============================================================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=${ERROR_INCLUDE_STACKTRACE:never}
server.error.include-exception=false
